{"ast":null,"code":"import _assertThisInitialized from\"E:\\\\Olympcepy\\\\settings\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _classCallCheck from\"E:\\\\Olympcepy\\\\settings\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _inherits from\"E:\\\\Olympcepy\\\\settings\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"E:\\\\Olympcepy\\\\settings\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";/*global chrome*/import Button from\"@material-ui/core/Button\";import CircularProgress from\"@material-ui/core/CircularProgress\";import Dialog from\"@material-ui/core/Dialog\";import DialogActions from\"@material-ui/core/DialogActions\";import DialogContent from\"@material-ui/core/DialogContent\";import DialogContentText from\"@material-ui/core/DialogContentText\";import DialogTitle from\"@material-ui/core/DialogTitle\";import List from\"@material-ui/core/List\";import ListItem from\"@material-ui/core/ListItem\";import ListItemIcon from\"@material-ui/core/ListItemIcon\";import ListItemText from\"@material-ui/core/ListItemText\";import Paper from\"@material-ui/core/Paper\";import Table from\"@material-ui/core/Table\";import TableBody from\"@material-ui/core/TableBody\";import TableCell from\"@material-ui/core/TableCell\";import TableContainer from\"@material-ui/core/TableContainer\";import TableHead from\"@material-ui/core/TableHead\";import TableRow from\"@material-ui/core/TableRow\";import TextField from\"@material-ui/core/TextField\";import AddIcon from\"@material-ui/icons/Add\";import EditIcon from\"@material-ui/icons/Edit\";import RefreshIcon from\"@material-ui/icons/Refresh\";import React from\"react\";import VKMethods from\"./VKMethods\";import Switch from\"@material-ui/core/Switch\";var APIKeyDialog=/*#__PURE__*/function(_React$Component){_inherits(APIKeyDialog,_React$Component);var _super=_createSuper(APIKeyDialog);function APIKeyDialog(props){var _this;_classCallCheck(this,APIKeyDialog);_this=_super.call(this,props);_this.onOk=function(){_this.props.onOk(_this.state.key);};_this.onCancel=function(){_this.props.onCancel();};_this.keyChanged=function(event){if(event.currentTarget){var newKey=event.currentTarget.value;_this.setState(function(state){state.key=newKey;return state;});}};_this.render=function(){return/*#__PURE__*/React.createElement(Dialog,{open:_this.props.open,onClose:_this.switchDialog,\"aria-labelledby\":\"form-dialog-title\"},/*#__PURE__*/React.createElement(DialogTitle,null,\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 API-\\u043A\\u043B\\u044E\\u0447 \\u0433\\u0440\\u0443\\u043F\\u043F\\u044B\"),/*#__PURE__*/React.createElement(DialogContent,null,/*#__PURE__*/React.createElement(DialogContentText,null,\"\\u0414\\u043B\\u044F \\u043E\\u0431\\u0435\\u0441\\u043F\\u0435\\u0447\\u0435\\u043D\\u0438\\u044F \\u0432\\u043E\\u0437\\u043C\\u043E\\u0436\\u043D\\u043E\\u0441\\u0442\\u0438 \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0438 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0439 \\u0432 \\u0447\\u0430\\u0442\\u044B \\u043D\\u0435\\u043E\\u0431\\u0445\\u043E\\u0434\\u0438\\u043C\\u043E \\u0443\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C API-\\u043A\\u043B\\u044E\\u0447 \\u0433\\u0440\\u0443\\u043F\\u043F\\u044B.\"),/*#__PURE__*/React.createElement(TextField,{autoFocus:true,margin:\"dense\",label:\"API-\\u043A\\u043B\\u044E\\u0447 \\u0433\\u0440\\u0443\\u043F\\u043F\\u044B\",fullWidth:true,onChange:_this.keyChanged})),/*#__PURE__*/React.createElement(DialogActions,null,/*#__PURE__*/React.createElement(Button,{onClick:_this.onCancel,color:\"primary\"},\"Cancel\"),/*#__PURE__*/React.createElement(Button,{onClick:_this.onOk,color:\"primary\"},\"Ok\")));};_this.state={key:\"\"};return _this;}return APIKeyDialog;}(React.Component);var MessagesTab=/*#__PURE__*/function(_React$Component2){_inherits(MessagesTab,_React$Component2);var _super2=_createSuper(MessagesTab);function MessagesTab(_props){var _this2;_classCallCheck(this,MessagesTab);_this2=_super2.call(this,_props);_this2.build=function(){return _this2.state.platform!=_this2.props.platform?_this2.setState(function(state,props){state.gotToken=false;state.platform=props.platform;state.loaded=false;state.groupToken=undefined;return state;},function(){_this2.rebuild();}):_this2.rebuild();};_this2.rebuild=function(){return!_this2.state.gotToken&&_this2.getMessages(function(platformMsg,setts){return platformMsg.groupToken&&_this2.gotToken(platformMsg.groupToken,_this2.reload);});};_this2.openDialog=function(){_this2.setState(function(state){state.openDialog=true;return state;});};_this2.closeDialog=function(){_this2.setState(function(state){state.openDialog=false;return state;});};_this2.getMessages=function(callback){var self=_assertThisInitialized(_this2);chrome.storage.local.get([\"settsData\"],function(res){var r=res;var data=r.settsData!=undefined?r.settsData:{};data.messages=data.messages?data.messages:[];data.messages[self.state.platform]=data.messages[self.state.platform]?data.messages[self.state.platform]:{};try{callback(data.messages[self.state.platform],data);}catch(e){console.error(\"TradeS Error\",e);}});};_this2.updateMessages=function(token,toSend,toShow,callback){_this2.getMessages(function(platformMsg,setts){platformMsg.groupToken=token;platformMsg.toSend=toSend?toSend:_this2.state.chats.filter(function(e){return e.selected;}).map(function(e){return e.id;});platformMsg.toShow=toShow?toShow:_this2.state.chats.filter(function(e){return e.shown;}).map(function(e){return e.id;});setts.messages[_this2.props.platform]=platformMsg;chrome.storage.local.set({settsData:setts},function(){try{callback(platformMsg,setts);}catch(e){console.error(\"TradeS Error\",e);}});});};_this2.gotToken=function(token,callback){_this2.getMessages(function(platformMsg,setts){_this2.updateMessages(token,platformMsg.toSend?platformMsg.toSend:[],platformMsg.toShow?platformMsg.toShow:[],function(){_this2.setState(function(state){state.gotToken=true;state.groupToken=token;state.openDialog=false;return state;},function(){try{callback(token,platformMsg,setts);}catch(e){console.error(\"TradeS Error\",e);}});});});};_this2.reload=function(){_this2.setState(function(state){state.loaded=false;state.openDialog=false;state.chats=undefined;return state;},function(){_this2.load();});};_this2.load=function(){_this2.getMessages(function(platformMsg,setts){var p={groupToken:platformMsg.groupToken,toSend:platformMsg.toSend?platformMsg.toSend:[],toShow:platformMsg.toShow?platformMsg.toShow:[]};VKMethods.getGroupChats(p.groupToken,function(result){if(result.error){alert(result);console.log(result);}_this2.setState(function(state){p.toSend=p.toSend?p.toSend:[];state.chats=result.response.items.filter(function(c){return c.conversation.peer.type==\"chat\";}).map(function(chat){return{id:chat.conversation.peer.id,name:chat.conversation.chat_settings.title,selected:p.toSend.includes(chat.conversation.peer.id),shown:p.toShow.includes(chat.conversation.peer.id)};});state.loaded=true;return state;},function(){_this2.updateMessages(platformMsg.groupToken);});});});};_this2.toSendChanged=function(chat){return function(event){chat.selected=!chat.selected;_this2.getMessages(function(platformMsg,setts){_this2.updateMessages(platformMsg.groupToken,_this2.state.chats.filter(function(e){return e.id==chat.id?chat.selected:e.selected;}).map(function(e){return e.id;}),_this2.state.chats.filter(function(e){return e.shown;}).map(function(e){return e.id;}),function(){_this2.setState(function(state){state.chats=state.chats.map(function(e){return e.id==chat.id?chat:e;});return state;});});});};};_this2.toShowChanged=function(chat){return function(event){chat.shown=!chat.shown;_this2.getMessages(function(platformMsg,setts){_this2.updateMessages(platformMsg.groupToken,_this2.state.chats.filter(function(e){return e.selected;}).map(function(e){return e.id;}),_this2.state.chats.filter(function(e){return e.id==chat.id?chat.shown:e.shown;}).map(function(e){return e.id;}),function(){_this2.setState(function(state){state.chats=state.chats.map(function(e){return e.id==chat.id?chat:e;});return state;});});});};};_this2.getChatRows=function(){return _this2.state.chats.map(function(e){return/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,null,e.name),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(Switch,{checked:e.selected,color:\"primary\",onChange:_this2.toSendChanged(e)})),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},/*#__PURE__*/React.createElement(Switch,{checked:e.shown,color:\"primary\",onChange:_this2.toShowChanged(e)})),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){_this2.getMessages(function(platformMsg){VKMethods.sendMessageToGroupChat(platformMsg.groupToken,e.id,\"Тестовое сообщение\");});}},\"\\u0422\\u0435\\u0441\\u0442\\u043E\\u0432\\u043E\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\")));});};_this2.getChatTable=function(){if(_this2.state.loaded){return/*#__PURE__*/React.createElement(TableContainer,{component:Paper},/*#__PURE__*/React.createElement(Table,null,/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,null,\"\\u0427\\u0430\\u0442\"),/*#__PURE__*/React.createElement(TableCell,null,\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0430\"),/*#__PURE__*/React.createElement(TableCell,null,\"\\u041E\\u0442\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435 \\u0434\\u043B\\u044F Trade-S Lite\"),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},/*#__PURE__*/React.createElement(Button,{onClick:_this2.reload},/*#__PURE__*/React.createElement(RefreshIcon,null))))),/*#__PURE__*/React.createElement(TableBody,null,_this2.getChatRows())));}return/*#__PURE__*/React.createElement(CircularProgress,{style:{padding:20}});};_this2.render=function(){_this2.build();if(_this2.state.gotToken){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(List,null,/*#__PURE__*/React.createElement(ListItem,{button:true,onClick:_this2.openDialog},/*#__PURE__*/React.createElement(ListItemIcon,null,/*#__PURE__*/React.createElement(EditIcon,null)),/*#__PURE__*/React.createElement(ListItemText,{primary:_this2.state.groupToken.slice(0,10)+\"...\"}))),/*#__PURE__*/React.createElement(APIKeyDialog,{open:_this2.state.openDialog,onCancel:_this2.closeDialog,onOk:function onOk(token){_this2.gotToken(token,_this2.reload);}}),_this2.getChatTable());}else if(_this2.state.gotToken!=undefined){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(List,null,/*#__PURE__*/React.createElement(ListItem,{button:true,onClick:_this2.openDialog},/*#__PURE__*/React.createElement(ListItemIcon,null,/*#__PURE__*/React.createElement(AddIcon,null)),/*#__PURE__*/React.createElement(ListItemText,{primary:\"Укажите API-ключ группы\"}))),/*#__PURE__*/React.createElement(APIKeyDialog,{open:_this2.state.openDialog,onCancel:_this2.closeDialog,onOk:function onOk(token){_this2.gotToken(token,_this2.reload);}}));}return/*#__PURE__*/React.createElement(CircularProgress,{style:{padding:20}});};_this2.state={platform:_this2.props.platform,openDialog:false,gotToken:false,loaded:false};return _this2;}return MessagesTab;}(React.Component);var PostsTab=/*#__PURE__*/function(_React$Component3){_inherits(PostsTab,_React$Component3);var _super3=_createSuper(PostsTab);function PostsTab(props){var _this3;_classCallCheck(this,PostsTab);_this3=_super3.call(this,props);_this3.build=function(){return _this3.state.platform!=_this3.props.platform?_this3.reload():undefined;};_this3.reload=function(){_this3.setState(function(state){state.loaded=false;state.groups=undefined;state.platform=_this3.props.platform;return state;},function(){_this3.load();});};_this3.load=function(){_this3.getPosts(function(posts,setts){var p=posts?posts:{};VKMethods.getMyGroups(function(result){if(result.error){alert(result);console.log(result);return;}_this3.setState(function(state){state.loaded=true;state.groups=result.response.items.map(function(e){return{id:e.id,name:e.name,selected:p.toSend&&p.toSend.includes(e.id),shown:p.toShow&&p.toShow.includes(e.id)};},function(){_this3.updatePosts(_this3.state.groups.filter(function(e){return e.selected;}).map(function(e){return e.id;}));});return state;});});});};_this3.getPosts=function(callback){var cb=callback;var self=_assertThisInitialized(_this3);chrome.storage.local.get([\"settsData\"],function(r){var posts=r.settsData.posts&&r.settsData.posts[self.state.platform]?r.settsData.posts[self.state.platform]:[];posts=posts.length!=undefined?{toSend:posts,toShow:[]}:posts;try{cb(posts,r.settsData);}catch(e){console.error(\"TradeS Error\",e);}});};_this3.updatePosts=function(toSend,toShow,callback){_this3.getPosts(function(posts,setts){var cb=callback;setts.posts=setts.posts?setts.posts:[];setts.posts[_this3.state.platform]={toSend:toSend?toSend:_this3.state.groups?_this3.state.groups.filter(function(e){return e.selected;}).map(function(e){return e.id;}):[],toShow:toShow?toShow:_this3.state.groups?_this3.state.groups.filter(function(e){return e.shown;}).map(function(e){return e.id;}):[]};chrome.storage.local.set({settsData:setts},function(){try{cb(setts);}catch(e){console.error(\"TradeS Error\",e);}});});};_this3.toSendChanged=function(group){return function(event){group.selected=!group.selected;_this3.updatePosts(_this3.state.groups.filter(function(e){return e.id==group.id?group.selected:e.selected;}).map(function(e){return e.id;}),undefined,function(){_this3.setState(function(state){state.loaded=true;state.groups=state.groups.map(function(e){return e.id==group.id?group:e;});return state;});});};};_this3.toShowChanged=function(group){return function(event){group.shown=!group.shown;_this3.updatePosts(undefined,_this3.state.groups.filter(function(e){return e.id==group.id?group.shown:e.shown;}).map(function(e){return e.id;}),function(){_this3.setState(function(state){state.loaded=true;state.groups=state.groups.map(function(e){return e.id==group.id?group:e;});return state;});});};};_this3.getGropuRows=function(){return _this3.state.groups.map(function(e){return/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,null,e.name),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(Switch,{checked:e.selected,color:\"primary\",onChange:_this3.toSendChanged(e)})),/*#__PURE__*/React.createElement(TableCell,{align:\"center\"},/*#__PURE__*/React.createElement(Switch,{checked:e.shown,color:\"primary\",onChange:_this3.toShowChanged(e)})),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){VKMethods.postOnMyGroupWall(e.id,\"Тестовый пост\");}},\"\\u0422\\u0435\\u0441\\u0442\\u043E\\u0432\\u044B\\u0439 \\u043F\\u043E\\u0441\\u0442\")));});};_this3.render=function(){_this3.build();if(_this3.state.loaded){return/*#__PURE__*/React.createElement(TableContainer,{component:Paper},/*#__PURE__*/React.createElement(Table,null,/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,null,\"\\u0413\\u0440\\u0443\\u043F\\u043F\\u0430\"),/*#__PURE__*/React.createElement(TableCell,null,\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0430\"),/*#__PURE__*/React.createElement(TableCell,null,\"\\u041E\\u0442\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435 \\u0434\\u043B\\u044F Trade-S Lite\"),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},/*#__PURE__*/React.createElement(Button,{onClick:_this3.reload},/*#__PURE__*/React.createElement(RefreshIcon,null))))),/*#__PURE__*/React.createElement(TableBody,null,_this3.getGropuRows())));}return/*#__PURE__*/React.createElement(CircularProgress,{style:{padding:20}});};_this3.state={loaded:false,platform:-1,//this.props.platform,\ngroups:undefined};return _this3;}return PostsTab;}(React.Component);export{MessagesTab,PostsTab};","map":{"version":3,"sources":["E:/Olympcepy/settings/src/TradeSTabs.js"],"names":["Button","CircularProgress","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","List","ListItem","ListItemIcon","ListItemText","Paper","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","TextField","AddIcon","EditIcon","RefreshIcon","React","VKMethods","Switch","APIKeyDialog","props","onOk","state","key","onCancel","keyChanged","event","currentTarget","newKey","value","setState","render","open","switchDialog","Component","MessagesTab","build","platform","gotToken","loaded","groupToken","undefined","rebuild","getMessages","platformMsg","setts","reload","openDialog","closeDialog","callback","self","chrome","storage","local","get","res","r","data","settsData","messages","e","console","error","updateMessages","token","toSend","toShow","chats","filter","selected","map","id","shown","set","load","p","getGroupChats","result","alert","log","response","items","c","conversation","peer","type","chat","name","chat_settings","title","includes","toSendChanged","toShowChanged","getChatRows","sendMessageToGroupChat","getChatTable","padding","slice","PostsTab","groups","getPosts","posts","getMyGroups","updatePosts","cb","length","group","getGropuRows","postOnMyGroupWall"],"mappings":"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","sourcesContent":["/*global chrome*/\r\n\r\nimport Button from \"@material-ui/core/Button\";\r\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogContentText from \"@material-ui/core/DialogContentText\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Table from \"@material-ui/core/Table\";\r\nimport TableBody from \"@material-ui/core/TableBody\";\r\nimport TableCell from \"@material-ui/core/TableCell\";\r\nimport TableContainer from \"@material-ui/core/TableContainer\";\r\nimport TableHead from \"@material-ui/core/TableHead\";\r\nimport TableRow from \"@material-ui/core/TableRow\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport React from \"react\";\r\nimport VKMethods from \"./VKMethods\";\r\nimport Switch from \"@material-ui/core/Switch\";\r\n\r\nclass APIKeyDialog extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { key: \"\" };\r\n    }\r\n\r\n    onOk = () => {\r\n        this.props.onOk(this.state.key);\r\n    };\r\n\r\n    onCancel = () => {\r\n        this.props.onCancel();\r\n    };\r\n\r\n    keyChanged = (event) => {\r\n        if (event.currentTarget) {\r\n            var newKey = event.currentTarget.value;\r\n            this.setState((state) => {\r\n                state.key = newKey;\r\n                return state;\r\n            });\r\n        }\r\n    };\r\n\r\n    render = () => {\r\n        return (\r\n            <Dialog\r\n                open={this.props.open}\r\n                onClose={this.switchDialog}\r\n                aria-labelledby=\"form-dialog-title\"\r\n            >\r\n                <DialogTitle>Введите API-ключ группы</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        Для обеспечения возможности отправки сообщений в чаты\r\n                        необходимо указать API-ключ группы.\r\n                    </DialogContentText>\r\n                    <TextField\r\n                        autoFocus\r\n                        margin=\"dense\"\r\n                        label=\"API-ключ группы\"\r\n                        fullWidth\r\n                        onChange={this.keyChanged}\r\n                    />\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={this.onCancel} color=\"primary\">\r\n                        Cancel\r\n                    </Button>\r\n                    <Button onClick={this.onOk} color=\"primary\">\r\n                        Ok\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        );\r\n    };\r\n}\r\n\r\nclass MessagesTab extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            platform: this.props.platform,\r\n            openDialog: false,\r\n            gotToken: false,\r\n            loaded: false,\r\n        };\r\n    }\r\n\r\n    build = () => {\r\n        return this.state.platform != this.props.platform\r\n            ? this.setState(\r\n                  (state, props) => {\r\n                      state.gotToken = false;\r\n                      state.platform = props.platform;\r\n                      state.loaded = false;\r\n                      state.groupToken = undefined;\r\n                      return state;\r\n                  },\r\n                  () => {\r\n                      this.rebuild();\r\n                  }\r\n              )\r\n            : this.rebuild();\r\n    };\r\n\r\n    rebuild = () => {\r\n        return (\r\n            !this.state.gotToken &&\r\n            this.getMessages((platformMsg, setts) => {\r\n                return (\r\n                    platformMsg.groupToken &&\r\n                    this.gotToken(platformMsg.groupToken, this.reload)\r\n                );\r\n            })\r\n        );\r\n    };\r\n\r\n    openDialog = () => {\r\n        this.setState((state) => {\r\n            state.openDialog = true;\r\n            return state;\r\n        });\r\n    };\r\n\r\n    closeDialog = () => {\r\n        this.setState((state) => {\r\n            state.openDialog = false;\r\n            return state;\r\n        });\r\n    };\r\n\r\n    getMessages = (callback) => {\r\n        var self = this;\r\n        chrome.storage.local.get([\"settsData\"], (res) => {\r\n            var r = res;\r\n            var data = r.settsData != undefined ? r.settsData : {};\r\n            data.messages = data.messages ? data.messages : [];\r\n            data.messages[self.state.platform] = data.messages[\r\n                self.state.platform\r\n            ]\r\n                ? data.messages[self.state.platform]\r\n                : {};\r\n            try {\r\n                callback(data.messages[self.state.platform], data);\r\n            } catch (e) {\r\n                console.error(\"TradeS Error\", e);\r\n            }\r\n        });\r\n    };\r\n\r\n    updateMessages = (token, toSend, toShow, callback) => {\r\n        this.getMessages((platformMsg, setts) => {\r\n            platformMsg.groupToken = token;\r\n            platformMsg.toSend = toSend\r\n                ? toSend\r\n                : this.state.chats.filter((e) => e.selected).map((e) => e.id);\r\n            platformMsg.toShow = toShow\r\n                ? toShow\r\n                : this.state.chats.filter((e) => e.shown).map((e) => e.id);\r\n            setts.messages[this.props.platform] = platformMsg;\r\n            chrome.storage.local.set({ settsData: setts }, () => {\r\n                try {\r\n                    callback(platformMsg, setts);\r\n                } catch (e) {\r\n                    console.error(\"TradeS Error\", e);\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    gotToken = (token, callback) => {\r\n        this.getMessages((platformMsg, setts) => {\r\n            this.updateMessages(\r\n                token,\r\n                platformMsg.toSend ? platformMsg.toSend : [],\r\n                platformMsg.toShow ? platformMsg.toShow : [],\r\n                () => {\r\n                    this.setState(\r\n                        (state) => {\r\n                            state.gotToken = true;\r\n                            state.groupToken = token;\r\n                            state.openDialog = false;\r\n                            return state;\r\n                        },\r\n                        () => {\r\n                            try {\r\n                                callback(token, platformMsg, setts);\r\n                            } catch (e) {\r\n                                console.error(\"TradeS Error\", e);\r\n                            }\r\n                        }\r\n                    );\r\n                }\r\n            );\r\n        });\r\n    };\r\n\r\n    reload = () => {\r\n        this.setState(\r\n            (state) => {\r\n                state.loaded = false;\r\n                state.openDialog = false;\r\n                state.chats = undefined;\r\n                return state;\r\n            },\r\n            () => {\r\n                this.load();\r\n            }\r\n        );\r\n    };\r\n\r\n    load = () => {\r\n        this.getMessages((platformMsg, setts) => {\r\n            var p = {\r\n                groupToken: platformMsg.groupToken,\r\n                toSend: platformMsg.toSend ? platformMsg.toSend : [],\r\n                toShow: platformMsg.toShow ? platformMsg.toShow : [],\r\n            };\r\n            VKMethods.getGroupChats(p.groupToken, (result) => {\r\n                if (result.error) {\r\n                    alert(result);\r\n                    console.log(result);\r\n                }\r\n                this.setState(\r\n                    (state) => {\r\n                        p.toSend = p.toSend ? p.toSend : [];\r\n                        state.chats = result.response.items\r\n                            .filter((c) => {\r\n                                return c.conversation.peer.type == \"chat\";\r\n                            })\r\n                            .map((chat) => {\r\n                                return {\r\n                                    id: chat.conversation.peer.id,\r\n                                    name: chat.conversation.chat_settings.title,\r\n                                    selected: p.toSend.includes(\r\n                                        chat.conversation.peer.id\r\n                                    ),\r\n                                    shown: p.toShow.includes(\r\n                                        chat.conversation.peer.id\r\n                                    ),\r\n                                };\r\n                            });\r\n                        state.loaded = true;\r\n\r\n                        return state;\r\n                    },\r\n                    () => {\r\n                        this.updateMessages(platformMsg.groupToken);\r\n                    }\r\n                );\r\n            });\r\n        });\r\n    };\r\n\r\n    toSendChanged = (chat) => (event) => {\r\n        chat.selected = !chat.selected;\r\n        this.getMessages((platformMsg, setts) => {\r\n            this.updateMessages(\r\n                platformMsg.groupToken,\r\n                this.state.chats\r\n                    .filter((e) =>\r\n                        e.id == chat.id ? chat.selected : e.selected\r\n                    )\r\n                    .map((e) => e.id),\r\n                this.state.chats.filter((e) => e.shown).map((e) => e.id),\r\n                () => {\r\n                    this.setState((state) => {\r\n                        state.chats = state.chats.map((e) => {\r\n                            return e.id == chat.id ? chat : e;\r\n                        });\r\n                        return state;\r\n                    });\r\n                }\r\n            );\r\n        });\r\n    };\r\n\r\n    toShowChanged = (chat) => (event) => {\r\n        chat.shown = !chat.shown;\r\n        this.getMessages((platformMsg, setts) => {\r\n            this.updateMessages(\r\n                platformMsg.groupToken,\r\n                this.state.chats.filter((e) => e.selected).map((e) => e.id),\r\n                this.state.chats\r\n                    .filter((e) => (e.id == chat.id ? chat.shown : e.shown))\r\n                    .map((e) => e.id),\r\n                () => {\r\n                    this.setState((state) => {\r\n                        state.chats = state.chats.map((e) => {\r\n                            return e.id == chat.id ? chat : e;\r\n                        });\r\n                        return state;\r\n                    });\r\n                }\r\n            );\r\n        });\r\n    };\r\n\r\n    getChatRows = () => {\r\n        return this.state.chats.map((e) => {\r\n            return (\r\n                <TableRow>\r\n                    <TableCell>{e.name}</TableCell>\r\n                    <TableCell>\r\n                        <Switch\r\n                            checked={e.selected}\r\n                            color=\"primary\"\r\n                            onChange={this.toSendChanged(e)}\r\n                        />\r\n                    </TableCell>\r\n                    <TableCell align=\"center\">\r\n                        <Switch\r\n                            checked={e.shown}\r\n                            color=\"primary\"\r\n                            onChange={this.toShowChanged(e)}\r\n                        />\r\n                    </TableCell>\r\n                    <TableCell align=\"right\">\r\n                        <Button\r\n                            onClick={() => {\r\n                                this.getMessages((platformMsg) => {\r\n                                    VKMethods.sendMessageToGroupChat(\r\n                                        platformMsg.groupToken,\r\n                                        e.id,\r\n                                        \"Тестовое сообщение\"\r\n                                    );\r\n                                });\r\n                            }}\r\n                        >\r\n                            Тестовое сообщение\r\n                        </Button>\r\n                    </TableCell>\r\n                </TableRow>\r\n            );\r\n        });\r\n    };\r\n\r\n    getChatTable = () => {\r\n        if (this.state.loaded) {\r\n            return (\r\n                <TableContainer component={Paper}>\r\n                    <Table>\r\n                        <TableHead>\r\n                            <TableRow>\r\n                                <TableCell>Чат</TableCell>\r\n                                <TableCell>Отправка</TableCell>\r\n                                <TableCell>\r\n                                    Отображение для Trade-S Lite\r\n                                </TableCell>\r\n                                <TableCell align=\"right\">\r\n                                    <Button onClick={this.reload}>\r\n                                        <RefreshIcon />\r\n                                    </Button>\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        </TableHead>\r\n                        <TableBody>{this.getChatRows()}</TableBody>\r\n                    </Table>\r\n                </TableContainer>\r\n            );\r\n        }\r\n        return <CircularProgress style={{ padding: 20 }} />;\r\n    };\r\n\r\n    render = () => {\r\n        this.build();\r\n        if (this.state.gotToken) {\r\n            return (\r\n                <>\r\n                    <List>\r\n                        <ListItem button onClick={this.openDialog}>\r\n                            <ListItemIcon>\r\n                                <EditIcon />\r\n                            </ListItemIcon>\r\n                            <ListItemText\r\n                                primary={\r\n                                    this.state.groupToken.slice(0, 10) + \"...\"\r\n                                }\r\n                            />\r\n                        </ListItem>\r\n                    </List>\r\n                    <APIKeyDialog\r\n                        open={this.state.openDialog}\r\n                        onCancel={this.closeDialog}\r\n                        onOk={(token) => {\r\n                            this.gotToken(token, this.reload);\r\n                        }}\r\n                    />\r\n                    {this.getChatTable()}\r\n                </>\r\n            );\r\n        } else if (this.state.gotToken != undefined) {\r\n            return (\r\n                <>\r\n                    <List>\r\n                        <ListItem button onClick={this.openDialog}>\r\n                            <ListItemIcon>\r\n                                <AddIcon />\r\n                            </ListItemIcon>\r\n                            <ListItemText primary={\"Укажите API-ключ группы\"} />\r\n                        </ListItem>\r\n                    </List>\r\n                    <APIKeyDialog\r\n                        open={this.state.openDialog}\r\n                        onCancel={this.closeDialog}\r\n                        onOk={(token) => {\r\n                            this.gotToken(token, this.reload);\r\n                        }}\r\n                    />\r\n                </>\r\n            );\r\n        }\r\n        return <CircularProgress style={{ padding: 20 }} />;\r\n    };\r\n}\r\n\r\nclass PostsTab extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            loaded: false,\r\n            platform: -1, //this.props.platform,\r\n            groups: undefined,\r\n        };\r\n    }\r\n\r\n    build = () => {\r\n        return this.state.platform != this.props.platform\r\n            ? this.reload()\r\n            : undefined;\r\n    };\r\n\r\n    reload = () => {\r\n        this.setState(\r\n            (state) => {\r\n                state.loaded = false;\r\n                state.groups = undefined;\r\n                state.platform = this.props.platform;\r\n                return state;\r\n            },\r\n            () => {\r\n                this.load();\r\n            }\r\n        );\r\n    };\r\n\r\n    load = () => {\r\n        this.getPosts((posts, setts) => {\r\n            var p = posts ? posts : {};\r\n            VKMethods.getMyGroups((result) => {\r\n                if (result.error) {\r\n                    alert(result);\r\n                    console.log(result);\r\n                    return;\r\n                }\r\n                this.setState((state) => {\r\n                    state.loaded = true;\r\n                    state.groups = result.response.items.map(\r\n                        (e) => {\r\n                            return {\r\n                                id: e.id,\r\n                                name: e.name,\r\n                                selected: p.toSend && p.toSend.includes(e.id),\r\n                                shown: p.toShow && p.toShow.includes(e.id),\r\n                            };\r\n                        },\r\n                        () => {\r\n                            this.updatePosts(\r\n                                this.state.groups\r\n                                    .filter((e) => e.selected)\r\n                                    .map((e) => e.id)\r\n                            );\r\n                        }\r\n                    );\r\n                    return state;\r\n                });\r\n            });\r\n        });\r\n    };\r\n\r\n    getPosts = (callback) => {\r\n        var cb = callback;\r\n        var self = this;\r\n        chrome.storage.local.get([\"settsData\"], (r) => {\r\n            var posts =\r\n                r.settsData.posts && r.settsData.posts[self.state.platform]\r\n                    ? r.settsData.posts[self.state.platform]\r\n                    : [];\r\n            posts =\r\n                posts.length != undefined\r\n                    ? { toSend: posts, toShow: [] }\r\n                    : posts;\r\n            try {\r\n                cb(posts, r.settsData);\r\n            } catch (e) {\r\n                console.error(\"TradeS Error\", e);\r\n            }\r\n        });\r\n    };\r\n\r\n    updatePosts = (toSend, toShow, callback) => {\r\n        this.getPosts((posts, setts) => {\r\n            var cb = callback;\r\n            setts.posts = setts.posts ? setts.posts : [];\r\n            setts.posts[this.state.platform] = {\r\n                toSend: toSend\r\n                    ? toSend\r\n                    : this.state.groups\r\n                    ? this.state.groups\r\n                          .filter((e) => e.selected)\r\n                          .map((e) => e.id)\r\n                    : [],\r\n                toShow: toShow\r\n                    ? toShow\r\n                    : this.state.groups\r\n                    ? this.state.groups.filter((e) => e.shown).map((e) => e.id)\r\n                    : [],\r\n            };\r\n            chrome.storage.local.set({ settsData: setts }, () => {\r\n                try {\r\n                    cb(setts);\r\n                } catch (e) {\r\n                    console.error(\"TradeS Error\", e);\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    toSendChanged = (group) => (event) => {\r\n        group.selected = !group.selected;\r\n\r\n        this.updatePosts(\r\n            this.state.groups\r\n                .filter((e) => (e.id == group.id ? group.selected : e.selected))\r\n                .map((e) => e.id),\r\n            undefined,\r\n            () => {\r\n                this.setState((state) => {\r\n                    state.loaded = true;\r\n                    state.groups = state.groups.map((e) => {\r\n                        return e.id == group.id ? group : e;\r\n                    });\r\n                    return state;\r\n                });\r\n            }\r\n        );\r\n    };\r\n\r\n    toShowChanged = (group) => (event) => {\r\n        group.shown = !group.shown;\r\n\r\n        this.updatePosts(\r\n            undefined,\r\n            this.state.groups\r\n                .filter((e) => (e.id == group.id ? group.shown : e.shown))\r\n                .map((e) => e.id),\r\n            () => {\r\n                this.setState((state) => {\r\n                    state.loaded = true;\r\n                    state.groups = state.groups.map((e) => {\r\n                        return e.id == group.id ? group : e;\r\n                    });\r\n                    return state;\r\n                });\r\n            }\r\n        );\r\n    };\r\n\r\n    getGropuRows = () => {\r\n        return this.state.groups.map((e) => {\r\n            return (\r\n                <TableRow>\r\n                    <TableCell>{e.name}</TableCell>\r\n                    <TableCell>\r\n                        <Switch\r\n                            checked={e.selected}\r\n                            color=\"primary\"\r\n                            onChange={this.toSendChanged(e)}\r\n                        />\r\n                    </TableCell>\r\n                    <TableCell align=\"center\">\r\n                        <Switch\r\n                            checked={e.shown}\r\n                            color=\"primary\"\r\n                            onChange={this.toShowChanged(e)}\r\n                        />\r\n                    </TableCell>\r\n                    <TableCell align=\"right\">\r\n                        <Button\r\n                            onClick={() => {\r\n                                VKMethods.postOnMyGroupWall(\r\n                                    e.id,\r\n                                    \"Тестовый пост\"\r\n                                );\r\n                            }}\r\n                        >\r\n                            Тестовый пост\r\n                        </Button>\r\n                    </TableCell>\r\n                </TableRow>\r\n            );\r\n        });\r\n    };\r\n\r\n    render = () => {\r\n        this.build();\r\n        if (this.state.loaded) {\r\n            return (\r\n                <TableContainer component={Paper}>\r\n                    <Table>\r\n                        <TableHead>\r\n                            <TableRow>\r\n                                <TableCell>Группа</TableCell>\r\n                                <TableCell>Отправка</TableCell>\r\n                                <TableCell>\r\n                                    Отображение для Trade-S Lite\r\n                                </TableCell>\r\n                                <TableCell align=\"right\">\r\n                                    <Button onClick={this.reload}>\r\n                                        <RefreshIcon />\r\n                                    </Button>\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        </TableHead>\r\n                        <TableBody>{this.getGropuRows()}</TableBody>\r\n                    </Table>\r\n                </TableContainer>\r\n            );\r\n        }\r\n        return <CircularProgress style={{ padding: 20 }} />;\r\n    };\r\n}\r\n\r\nexport { MessagesTab, PostsTab };\r\n"]},"metadata":{},"sourceType":"module"}