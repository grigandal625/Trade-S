{"ast":null,"code":"import _assertThisInitialized from\"E:\\\\Olympcepy\\\\settings\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _classCallCheck from\"E:\\\\Olympcepy\\\\settings\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _inherits from\"E:\\\\Olympcepy\\\\settings\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"E:\\\\Olympcepy\\\\settings\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";/*global chrome*/import Button from\"@material-ui/core/Button\";import CircularProgress from\"@material-ui/core/CircularProgress\";import Dialog from\"@material-ui/core/Dialog\";import DialogActions from\"@material-ui/core/DialogActions\";import DialogContent from\"@material-ui/core/DialogContent\";import DialogContentText from\"@material-ui/core/DialogContentText\";import DialogTitle from\"@material-ui/core/DialogTitle\";import List from\"@material-ui/core/List\";import ListItem from\"@material-ui/core/ListItem\";import ListItemIcon from\"@material-ui/core/ListItemIcon\";import ListItemText from\"@material-ui/core/ListItemText\";import Paper from\"@material-ui/core/Paper\";import Table from\"@material-ui/core/Table\";import TableBody from\"@material-ui/core/TableBody\";import TableCell from\"@material-ui/core/TableCell\";import TableContainer from\"@material-ui/core/TableContainer\";import TableHead from\"@material-ui/core/TableHead\";import TableRow from\"@material-ui/core/TableRow\";import TextField from\"@material-ui/core/TextField\";import AddIcon from\"@material-ui/icons/Add\";import EditIcon from\"@material-ui/icons/Edit\";import RefreshIcon from\"@material-ui/icons/Refresh\";import React from\"react\";import VKMethods from\"./VKMethods\";import Switch from\"@material-ui/core/Switch\";var APIKeyDialog=/*#__PURE__*/function(_React$Component){_inherits(APIKeyDialog,_React$Component);var _super=_createSuper(APIKeyDialog);function APIKeyDialog(props){var _this;_classCallCheck(this,APIKeyDialog);_this=_super.call(this,props);_this.onOk=function(){_this.props.onOk(_this.state.key);};_this.onCancel=function(){_this.props.onCancel();};_this.keyChanged=function(event){if(event.currentTarget){var newKey=event.currentTarget.value;_this.setState(function(state){state.key=newKey;return state;});}};_this.render=function(){return/*#__PURE__*/React.createElement(Dialog,{open:_this.props.open,onClose:_this.switchDialog,\"aria-labelledby\":\"form-dialog-title\"},/*#__PURE__*/React.createElement(DialogTitle,null,\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 API-\\u043A\\u043B\\u044E\\u0447 \\u0433\\u0440\\u0443\\u043F\\u043F\\u044B\"),/*#__PURE__*/React.createElement(DialogContent,null,/*#__PURE__*/React.createElement(DialogContentText,null,\"\\u0414\\u043B\\u044F \\u043E\\u0431\\u0435\\u0441\\u043F\\u0435\\u0447\\u0435\\u043D\\u0438\\u044F \\u0432\\u043E\\u0437\\u043C\\u043E\\u0436\\u043D\\u043E\\u0441\\u0442\\u0438 \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0438 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0439 \\u0432 \\u0447\\u0430\\u0442\\u044B \\u043D\\u0435\\u043E\\u0431\\u0445\\u043E\\u0434\\u0438\\u043C\\u043E \\u0443\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C API-\\u043A\\u043B\\u044E\\u0447 \\u0433\\u0440\\u0443\\u043F\\u043F\\u044B.\"),/*#__PURE__*/React.createElement(TextField,{autoFocus:true,margin:\"dense\",label:\"API-\\u043A\\u043B\\u044E\\u0447 \\u0433\\u0440\\u0443\\u043F\\u043F\\u044B\",fullWidth:true,onChange:_this.keyChanged})),/*#__PURE__*/React.createElement(DialogActions,null,/*#__PURE__*/React.createElement(Button,{onClick:_this.onCancel,color:\"primary\"},\"Cancel\"),/*#__PURE__*/React.createElement(Button,{onClick:_this.onOk,color:\"primary\"},\"Ok\")));};_this.state={key:\"\"};return _this;}return APIKeyDialog;}(React.Component);var MessagesTab=/*#__PURE__*/function(_React$Component2){_inherits(MessagesTab,_React$Component2);var _super2=_createSuper(MessagesTab);function MessagesTab(_props){var _this2;_classCallCheck(this,MessagesTab);_this2=_super2.call(this,_props);_this2.openDialog=function(){_this2.setState(function(state){state.openDialog=true;return state;});};_this2.closeDialog=function(){_this2.setState(function(state){state.openDialog=false;return state;});};_this2.loadChats=function(){if(_this2.state.renderedPlatform!=_this2.props.platform){_this2.load();}};_this2.reload=function(){_this2.setState(function(state,props){state.hasToken=undefined;state.renderedPlatform=-1;return state;});};_this2.load=function(){var self=_assertThisInitialized(_this2);chrome.storage.local.get([\"settsData\"],function(res){var r=res;if(r.settsData!=undefined&&r.settsData.messages&&r.settsData.messages[_this2.props.platform]&&r.settsData.messages[_this2.props.platform].groupToken){self.gotToken(r.settsData.messages[_this2.props.platform].groupToken);}else{self.setState(function(state,props){state.settsData=r.settsData;state.renderedPlatform=props.platform;state.hasToken=false;state.groupToken=undefined;return state;});}});};_this2.tokenRecieved=function(token){_this2.gotToken(token,_this2.reload);};_this2.gotToken=function(token,callback){var self=_assertThisInitialized(_this2);var t=token;var cb=callback;chrome.storage.local.get([\"settsData\"],function(res){var r=res;var data=r.settsData!=undefined?r.settsData:{};data.messages=data.messages?data.messages:[];data.messages[self.props.platform]=data.messages[self.props.platform]?data.messages[self.props.platform]:{};data.messages[self.props.platform].groupToken=t;data.messages[self.props.platform].toSend=data.messages[self.props.platform].toSend?data.messages[self.props.platform].toSend:[];chrome.storage.local.set({settsData:data},function(){self.setState(function(state,props){state.settsData=r.settsData;state.renderedPlatform=props.platform;state.hasToken=true;state.groupToken=t;state.openDialog=false;return state;},function(){try{cb();}catch(e){}});});});};_this2.render=function(){_this2.loadChats();if(_this2.state.hasToken==undefined){return/*#__PURE__*/React.createElement(CircularProgress,{style:{padding:20}});}else if(_this2.state.hasToken){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(List,null,/*#__PURE__*/React.createElement(ListItem,{button:true,onClick:_this2.openDialog},/*#__PURE__*/React.createElement(ListItemIcon,null,/*#__PURE__*/React.createElement(EditIcon,null)),/*#__PURE__*/React.createElement(ListItemText,{primary:_this2.state.groupToken.slice(0,10)+\"...\"}))),/*#__PURE__*/React.createElement(APIKeyDialog,{open:_this2.state.openDialog,onCancel:_this2.closeDialog,onOk:_this2.tokenRecieved}),/*#__PURE__*/React.createElement(ChatSelector,{platform:_this2.props.platform,token:_this2.state.groupToken,data:_this2.state.settsData,tab:_assertThisInitialized(_this2)}));}else{return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(List,null,/*#__PURE__*/React.createElement(ListItem,{button:true,onClick:_this2.openDialog},/*#__PURE__*/React.createElement(ListItemIcon,null,/*#__PURE__*/React.createElement(AddIcon,null)),/*#__PURE__*/React.createElement(ListItemText,{primary:\"Укажите API-ключ группы\"}))),/*#__PURE__*/React.createElement(APIKeyDialog,{open:_this2.state.openDialog,onCancel:_this2.closeDialog,onOk:_this2.gotToken}));}};_this2.state={openDialog:false};return _this2;}return MessagesTab;}(React.Component);var ChatSelector=/*#__PURE__*/function(_React$Component3){_inherits(ChatSelector,_React$Component3);var _super3=_createSuper(ChatSelector);function ChatSelector(_props2){var _this3;_classCallCheck(this,ChatSelector);_this3=_super3.call(this,_props2);_this3.loadChats=function(){if(_this3.props.platform!=-1){VKMethods.getGroupChats(_this3.props.token,_this3.chatsRecieved);}};_this3.chatsRecieved=function(result){if(result.error){alert(result);console.log(result);_this3.setState(function(state){state.loaded=false;return state;});return;}var chats=result.response.items.filter(function(e){return e.conversation.peer.type==\"chat\";}).map(function(e){return{name:e.conversation.chat_settings.title,id:e.conversation.peer.id};});var self=_assertThisInitialized(_this3);chrome.storage.local.get([\"settsData\"],function(res){var r=res;var data=r.settsData?r.settsData:{};data.messages=data.messages?data.messages:[];data.messages[self.props.platform]=data.messages[self.props.platform]?data.messages[self.props.platform]:{};data.messages[self.props.platform].toSend=data.messages[self.props.platform].toSend?data.messages[self.props.platform].toSend:[];var selected=data.messages[self.props.platform].toSend;self.updateChats(chats.map(function(c){c.selected=selected.includes(c.id);return c;}));});};_this3.updateChats=function(cs){var chats=cs;var self=_assertThisInitialized(_this3);chrome.storage.local.get([\"settsData\"],function(res){var r=res;var data=r.settsData?r.settsData:{};data.messages=data.messages?data.messages:[];data.messages[self.props.platform]=data.messages[self.props.platform]?data.messages[self.props.platform]:{};data.messages[self.props.platform].toSend=chats.filter(function(e){return e.selected;}).map(function(e){return e.id;});chrome.storage.local.set({settsData:data},function(){self.setState(function(state,props){state.renderedPlatform=props.platform;state.loaded=true;state.chats=chats;return state;});});});};_this3.toSendChanged=function(c){return function(event){var chat=c;_this3.updateChats(_this3.state.chats.map(function(e){e.selected=e.id!=chat.id?e.selected:!chat.selected;return e;}));};};_this3.getChatRows=function(){return _this3.state.chats.map(function(e){return/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,null,e.name),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(Switch,{checked:e.selected,color:\"primary\",onChange:_this3.toSendChanged(e)})),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){console.log(\"sending\");VKMethods.sendMessageToGroupChat(_this3.props.token,e.id,\"Тестовое сообщение\");}},\"\\u0422\\u0435\\u0441\\u0442\\u043E\\u0432\\u043E\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\")));});};_this3.render=function(){if(_this3.state.renderedPlatform!=_this3.props.platform){_this3.props.tab.reload();}if(_this3.state.loaded){return/*#__PURE__*/React.createElement(TableContainer,{component:Paper},/*#__PURE__*/React.createElement(Table,null,/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,null,\"\\u0427\\u0430\\u0442\"),/*#__PURE__*/React.createElement(TableCell,null,\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0430\"),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},/*#__PURE__*/React.createElement(Button,{onClick:_this3.props.tab.reload},/*#__PURE__*/React.createElement(RefreshIcon,null))))),/*#__PURE__*/React.createElement(TableBody,null,_this3.getChatRows(_this3.state.chats))));}else{return/*#__PURE__*/React.createElement(CircularProgress,{style:{padding:20}});}};_this3.state={loaded:false,renderedPlatform:_props2.platform};_this3.loadChats();return _this3;}return ChatSelector;}(React.Component);var PostsTab=/*#__PURE__*/function(_React$Component4){_inherits(PostsTab,_React$Component4);var _super4=_createSuper(PostsTab);function PostsTab(props){var _this4;_classCallCheck(this,PostsTab);_this4=_super4.call(this,props);_this4.loadGroups=function(){_this4.setState(function(state){state.loaded=true;return state;});};_this4.reload=function(){_this4.setState(function(state){state.loaded=false;return state;});};_this4.render=function(){if(!_this4.state.loaded){_this4.loadGroups();return/*#__PURE__*/React.createElement(CircularProgress,{style:{padding:20}});}return/*#__PURE__*/React.createElement(GroupsSelector,{platform:_this4.props.platform,tab:_assertThisInitialized(_this4)});};_this4.state={loaded:false};return _this4;}return PostsTab;}(React.Component);var GroupsSelector=/*#__PURE__*/function(_React$Component5){_inherits(GroupsSelector,_React$Component5);var _super5=_createSuper(GroupsSelector);function GroupsSelector(props){var _this5;_classCallCheck(this,GroupsSelector);_this5=_super5.call(this,props);_this5.loadGroups=function(){VKMethods.getMyGroups(function(result){var res=result;if(res.error){alert(res);console.log(res);return;}chrome.storage.local.get([\"settsData\"],function(r){_this5.setState(function(state){state.groups=res.response.items.map(function(e){return{id:e.id,name:e.name,selected:r.settsData&&r.settsData.posts&&r.settsData.posts[_this5.props.platform]&&r.settsData.posts[_this5.props.platform].includes(e.id)};});state.renderedPlatform=_this5.props.platform;state.loaded=true;return state;});});});};_this5.updateGroups=function(groups){var self=_assertThisInitialized(_this5);chrome.storage.local.get([\"settsData\"],function(r){var setts=r.settsData?r.settsData:{};setts.posts=setts.posts?setts.posts:[];setts.posts[_this5.props.platform]=groups.filter(function(e){return e.selected;}).map(function(e){return e.id;});chrome.storage.local.set({settsData:setts},function(){self.setState(function(state){state.groups=state.groups.map(function(e){e.selected=setts.posts[_this5.props.platform].includes(e.id);return e;});return state;});});});};_this5.toSendChanged=function(group){return function(event){_this5.updateGroups(_this5.state.groups.map(function(e){e.selected=e.id!=group.id?e.selected:!group.selected;return e;}));};};_this5.getGroupRows=function(data){return data.map(function(e){return/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,null,e.name),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(Switch,{checked:e.selected,color:\"primary\",onChange:_this5.toSendChanged(e)})),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){console.log(\"sending\");VKMethods.postOnMyGroupWall(e.id,\"Тестовый пост\");}},\"\\u0422\\u0435\\u0441\\u0442\\u043E\\u0432\\u044B\\u0439 \\u043F\\u043E\\u0441\\u0442\")));});};_this5.render=function(){if(_this5.state.renderedPlatform!=_this5.props.platform){_this5.props.tab.reload();}if(!_this5.state.loaded){return/*#__PURE__*/React.createElement(CircularProgress,{style:{padding:20}});}return/*#__PURE__*/React.createElement(TableContainer,{component:Paper},/*#__PURE__*/React.createElement(Table,null,/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,null,\"\\u0413\\u0440\\u0443\\u043F\\u043F\\u0430\"),/*#__PURE__*/React.createElement(TableCell,null,\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043A\\u0430\"),/*#__PURE__*/React.createElement(TableCell,{align:\"right\"},/*#__PURE__*/React.createElement(Button,{onClick:_this5.props.tab.reload},/*#__PURE__*/React.createElement(RefreshIcon,null))))),/*#__PURE__*/React.createElement(TableBody,null,_this5.getGroupRows(_this5.state.groups))));};_this5.state={renderedPlatform:props.platform,loaded:false};return _this5;}return GroupsSelector;}(React.Component);export{MessagesTab,PostsTab};","map":{"version":3,"sources":["E:/Olympcepy/settings/src/TradeSTabs.js"],"names":["Button","CircularProgress","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","List","ListItem","ListItemIcon","ListItemText","Paper","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","TextField","AddIcon","EditIcon","RefreshIcon","React","VKMethods","Switch","APIKeyDialog","props","onOk","state","key","onCancel","keyChanged","event","currentTarget","newKey","value","setState","render","open","switchDialog","Component","MessagesTab","openDialog","closeDialog","loadChats","renderedPlatform","platform","load","reload","hasToken","undefined","self","chrome","storage","local","get","res","r","settsData","messages","groupToken","gotToken","tokenRecieved","token","callback","t","cb","data","toSend","set","e","padding","slice","ChatSelector","getGroupChats","chatsRecieved","result","error","alert","console","log","loaded","chats","response","items","filter","conversation","peer","type","map","name","chat_settings","title","id","selected","updateChats","c","includes","cs","toSendChanged","chat","getChatRows","sendMessageToGroupChat","tab","PostsTab","loadGroups","GroupsSelector","getMyGroups","groups","posts","updateGroups","setts","group","getGroupRows","postOnMyGroupWall"],"mappings":"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","sourcesContent":["/*global chrome*/\r\n\r\nimport Button from \"@material-ui/core/Button\";\r\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\r\nimport Dialog from \"@material-ui/core/Dialog\";\r\nimport DialogActions from \"@material-ui/core/DialogActions\";\r\nimport DialogContent from \"@material-ui/core/DialogContent\";\r\nimport DialogContentText from \"@material-ui/core/DialogContentText\";\r\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Table from \"@material-ui/core/Table\";\r\nimport TableBody from \"@material-ui/core/TableBody\";\r\nimport TableCell from \"@material-ui/core/TableCell\";\r\nimport TableContainer from \"@material-ui/core/TableContainer\";\r\nimport TableHead from \"@material-ui/core/TableHead\";\r\nimport TableRow from \"@material-ui/core/TableRow\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\nimport RefreshIcon from \"@material-ui/icons/Refresh\";\r\nimport React from \"react\";\r\nimport VKMethods from \"./VKMethods\";\r\nimport Switch from \"@material-ui/core/Switch\";\r\n\r\nclass APIKeyDialog extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { key: \"\" };\r\n    }\r\n\r\n    onOk = () => {\r\n        this.props.onOk(this.state.key);\r\n    };\r\n\r\n    onCancel = () => {\r\n        this.props.onCancel();\r\n    };\r\n\r\n    keyChanged = (event) => {\r\n        if (event.currentTarget) {\r\n            var newKey = event.currentTarget.value;\r\n            this.setState((state) => {\r\n                state.key = newKey;\r\n                return state;\r\n            });\r\n        }\r\n    };\r\n\r\n    render = () => {\r\n        return (\r\n            <Dialog\r\n                open={this.props.open}\r\n                onClose={this.switchDialog}\r\n                aria-labelledby=\"form-dialog-title\"\r\n            >\r\n                <DialogTitle>Введите API-ключ группы</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        Для обеспечения возможности отправки сообщений в чаты\r\n                        необходимо указать API-ключ группы.\r\n                    </DialogContentText>\r\n                    <TextField\r\n                        autoFocus\r\n                        margin=\"dense\"\r\n                        label=\"API-ключ группы\"\r\n                        fullWidth\r\n                        onChange={this.keyChanged}\r\n                    />\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={this.onCancel} color=\"primary\">\r\n                        Cancel\r\n                    </Button>\r\n                    <Button onClick={this.onOk} color=\"primary\">\r\n                        Ok\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        );\r\n    };\r\n}\r\n\r\nclass MessagesTab extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { openDialog: false };\r\n    }\r\n\r\n    openDialog = () => {\r\n        this.setState((state) => {\r\n            state.openDialog = true;\r\n            return state;\r\n        });\r\n    };\r\n\r\n    closeDialog = () => {\r\n        this.setState((state) => {\r\n            state.openDialog = false;\r\n            return state;\r\n        });\r\n    };\r\n\r\n    loadChats = () => {\r\n        if (this.state.renderedPlatform != this.props.platform) {\r\n            this.load();\r\n        }\r\n    };\r\n\r\n    reload = () => {\r\n        this.setState((state, props) => {\r\n            state.hasToken = undefined;\r\n            state.renderedPlatform = -1;\r\n            return state;\r\n        });\r\n    };\r\n\r\n    load = () => {\r\n        var self = this;\r\n        chrome.storage.local.get([\"settsData\"], (res) => {\r\n            var r = res;\r\n            if (\r\n                r.settsData != undefined &&\r\n                r.settsData.messages &&\r\n                r.settsData.messages[this.props.platform] &&\r\n                r.settsData.messages[this.props.platform].groupToken\r\n            ) {\r\n                self.gotToken(\r\n                    r.settsData.messages[this.props.platform].groupToken\r\n                );\r\n            } else {\r\n                self.setState((state, props) => {\r\n                    state.settsData = r.settsData;\r\n                    state.renderedPlatform = props.platform;\r\n                    state.hasToken = false;\r\n                    state.groupToken = undefined;\r\n                    return state;\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    tokenRecieved = (token) => {\r\n        this.gotToken(token, this.reload);\r\n    };\r\n\r\n    gotToken = (token, callback) => {\r\n        var self = this;\r\n        var t = token;\r\n        var cb = callback;\r\n        chrome.storage.local.get([\"settsData\"], (res) => {\r\n            var r = res;\r\n            var data = r.settsData != undefined ? r.settsData : {};\r\n            data.messages = data.messages ? data.messages : [];\r\n            data.messages[self.props.platform] = data.messages[\r\n                self.props.platform\r\n            ]\r\n                ? data.messages[self.props.platform]\r\n                : {};\r\n            data.messages[self.props.platform].groupToken = t;\r\n            data.messages[self.props.platform].toSend = data.messages[\r\n                self.props.platform\r\n            ].toSend\r\n                ? data.messages[self.props.platform].toSend\r\n                : [];\r\n            chrome.storage.local.set({ settsData: data }, () => {\r\n                self.setState(\r\n                    (state, props) => {\r\n                        state.settsData = r.settsData;\r\n                        state.renderedPlatform = props.platform;\r\n                        state.hasToken = true;\r\n                        state.groupToken = t;\r\n                        state.openDialog = false;\r\n                        return state;\r\n                    },\r\n                    () => {\r\n                        try {\r\n                            cb();\r\n                        } catch (e) {}\r\n                    }\r\n                );\r\n            });\r\n        });\r\n    };\r\n\r\n    render = () => {\r\n        this.loadChats();\r\n        if (this.state.hasToken == undefined) {\r\n            return <CircularProgress style={{ padding: 20 }} />;\r\n        } else if (this.state.hasToken) {\r\n            return (\r\n                <>\r\n                    <List>\r\n                        <ListItem button onClick={this.openDialog}>\r\n                            <ListItemIcon>\r\n                                <EditIcon />\r\n                            </ListItemIcon>\r\n                            <ListItemText\r\n                                primary={\r\n                                    this.state.groupToken.slice(0, 10) + \"...\"\r\n                                }\r\n                            />\r\n                        </ListItem>\r\n                    </List>\r\n                    <APIKeyDialog\r\n                        open={this.state.openDialog}\r\n                        onCancel={this.closeDialog}\r\n                        onOk={this.tokenRecieved}\r\n                    />\r\n                    <ChatSelector\r\n                        platform={this.props.platform}\r\n                        token={this.state.groupToken}\r\n                        data={this.state.settsData}\r\n                        tab={this}\r\n                    />\r\n                </>\r\n            );\r\n        } else {\r\n            return (\r\n                <>\r\n                    <List>\r\n                        <ListItem button onClick={this.openDialog}>\r\n                            <ListItemIcon>\r\n                                <AddIcon />\r\n                            </ListItemIcon>\r\n                            <ListItemText primary={\"Укажите API-ключ группы\"} />\r\n                        </ListItem>\r\n                    </List>\r\n                    <APIKeyDialog\r\n                        open={this.state.openDialog}\r\n                        onCancel={this.closeDialog}\r\n                        onOk={this.gotToken}\r\n                    />\r\n                </>\r\n            );\r\n        }\r\n    };\r\n}\r\n\r\nclass ChatSelector extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { loaded: false, renderedPlatform: props.platform };\r\n        this.loadChats();\r\n    }\r\n\r\n    loadChats = () => {\r\n        if (this.props.platform != -1) {\r\n            VKMethods.getGroupChats(this.props.token, this.chatsRecieved);\r\n        }\r\n    };\r\n\r\n    chatsRecieved = (result) => {\r\n        if (result.error) {\r\n            alert(result);\r\n            console.log(result);\r\n            this.setState((state) => {\r\n                state.loaded = false;\r\n                return state;\r\n            });\r\n            return;\r\n        }\r\n        var chats = result.response.items\r\n            .filter((e) => e.conversation.peer.type == \"chat\")\r\n            .map((e) => {\r\n                return {\r\n                    name: e.conversation.chat_settings.title,\r\n                    id: e.conversation.peer.id,\r\n                };\r\n            });\r\n        var self = this;\r\n        chrome.storage.local.get([\"settsData\"], (res) => {\r\n            var r = res;\r\n            var data = r.settsData ? r.settsData : {};\r\n            data.messages = data.messages ? data.messages : [];\r\n\r\n            data.messages[self.props.platform] = data.messages[\r\n                self.props.platform\r\n            ]\r\n                ? data.messages[self.props.platform]\r\n                : {};\r\n\r\n            data.messages[self.props.platform].toSend = data.messages[\r\n                self.props.platform\r\n            ].toSend\r\n                ? data.messages[self.props.platform].toSend\r\n                : [];\r\n\r\n            var selected = data.messages[self.props.platform].toSend;\r\n            self.updateChats(\r\n                chats.map((c) => {\r\n                    c.selected = selected.includes(c.id);\r\n                    return c;\r\n                })\r\n            );\r\n        });\r\n    };\r\n\r\n    updateChats = (cs) => {\r\n        var chats = cs;\r\n        var self = this;\r\n        chrome.storage.local.get([\"settsData\"], (res) => {\r\n            var r = res;\r\n            var data = r.settsData ? r.settsData : {};\r\n            data.messages = data.messages ? data.messages : [];\r\n\r\n            data.messages[self.props.platform] = data.messages[\r\n                self.props.platform\r\n            ]\r\n                ? data.messages[self.props.platform]\r\n                : {};\r\n\r\n            data.messages[self.props.platform].toSend = chats\r\n                .filter((e) => e.selected)\r\n                .map((e) => e.id);\r\n\r\n            chrome.storage.local.set({ settsData: data }, () => {\r\n                self.setState((state, props) => {\r\n                    state.renderedPlatform = props.platform;\r\n                    state.loaded = true;\r\n                    state.chats = chats;\r\n                    return state;\r\n                });\r\n            });\r\n        });\r\n    };\r\n\r\n    toSendChanged = (c) => (event) => {\r\n        var chat = c;\r\n        this.updateChats(\r\n            this.state.chats.map((e) => {\r\n                e.selected = e.id != chat.id ? e.selected : !chat.selected;\r\n                return e;\r\n            })\r\n        );\r\n    };\r\n\r\n    getChatRows = () => {\r\n        return this.state.chats.map((e) => {\r\n            return (\r\n                <TableRow>\r\n                    <TableCell>{e.name}</TableCell>\r\n                    <TableCell>\r\n                        <Switch\r\n                            checked={e.selected}\r\n                            color=\"primary\"\r\n                            onChange={this.toSendChanged(e)}\r\n                        />\r\n                    </TableCell>\r\n                    <TableCell align=\"right\">\r\n                        <Button\r\n                            onClick={() => {\r\n                                console.log(\"sending\");\r\n                                VKMethods.sendMessageToGroupChat(\r\n                                    this.props.token,\r\n                                    e.id,\r\n                                    \"Тестовое сообщение\"\r\n                                );\r\n                            }}\r\n                        >\r\n                            Тестовое сообщение\r\n                        </Button>\r\n                    </TableCell>\r\n                </TableRow>\r\n            );\r\n        });\r\n    };\r\n\r\n    render = () => {\r\n        if (this.state.renderedPlatform != this.props.platform) {\r\n            this.props.tab.reload();\r\n        }\r\n        if (this.state.loaded) {\r\n            return (\r\n                <TableContainer component={Paper}>\r\n                    <Table>\r\n                        <TableHead>\r\n                            <TableRow>\r\n                                <TableCell>Чат</TableCell>\r\n                                <TableCell>Отправка</TableCell>\r\n                                <TableCell align=\"right\">\r\n                                    <Button onClick={this.props.tab.reload}>\r\n                                        <RefreshIcon />\r\n                                    </Button>\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        </TableHead>\r\n                        <TableBody>\r\n                            {this.getChatRows(this.state.chats)}\r\n                        </TableBody>\r\n                    </Table>\r\n                </TableContainer>\r\n            );\r\n        } else {\r\n            return <CircularProgress style={{ padding: 20 }} />;\r\n        }\r\n    };\r\n}\r\n\r\nclass PostsTab extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { loaded: false };\r\n    }\r\n\r\n    loadGroups = () => {\r\n        this.setState((state) => {\r\n            state.loaded = true;\r\n            return state;\r\n        });\r\n    };\r\n\r\n    reload = () => {\r\n        this.setState((state) => {\r\n            state.loaded = false;\r\n            return state;\r\n        });\r\n    };\r\n\r\n    render = () => {\r\n        if (!this.state.loaded) {\r\n            this.loadGroups();\r\n            return <CircularProgress style={{ padding: 20 }} />;\r\n        }\r\n        return <GroupsSelector platform={this.props.platform} tab={this} />;\r\n    };\r\n}\r\n\r\nclass GroupsSelector extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            renderedPlatform: props.platform,\r\n            loaded: false,\r\n        };\r\n    }\r\n\r\n    loadGroups = () => {\r\n        VKMethods.getMyGroups((result) => {\r\n            var res = result;\r\n            if (res.error) {\r\n                alert(res);\r\n                console.log(res);\r\n                return;\r\n            }\r\n            chrome.storage.local.get([\"settsData\"], (r) => {\r\n                this.setState((state) => {\r\n                    state.groups = res.response.items.map((e) => {\r\n                        return {\r\n                            id: e.id,\r\n                            name: e.name,\r\n                            selected:\r\n                                r.settsData &&\r\n                                r.settsData.posts &&\r\n                                r.settsData.posts[this.props.platform] &&\r\n                                r.settsData.posts[this.props.platform].includes(\r\n                                    e.id\r\n                                ),\r\n                        };\r\n                    });\r\n                    state.renderedPlatform = this.props.platform;\r\n                    state.loaded = true;\r\n                    return state;\r\n                });\r\n            });\r\n        });\r\n    };\r\n\r\n    updateGroups = (groups) => {\r\n        var self = this;\r\n        chrome.storage.local.get([\"settsData\"], (r) => {\r\n            var setts = r.settsData ? r.settsData : {};\r\n            setts.posts = setts.posts ? setts.posts : [];\r\n            setts.posts[this.props.platform] = groups\r\n                .filter((e) => e.selected)\r\n                .map((e) => e.id);\r\n            chrome.storage.local.set({ settsData: setts }, () => {\r\n                self.setState((state) => {\r\n                    state.groups = state.groups.map((e) => {\r\n                        e.selected = setts.posts[this.props.platform].includes(\r\n                            e.id\r\n                        );\r\n                        return e;\r\n                    });\r\n                    return state;\r\n                });\r\n            });\r\n        });\r\n    };\r\n\r\n    toSendChanged = (group) => (event) => {\r\n        this.updateGroups(\r\n            this.state.groups.map((e) => {\r\n                e.selected = e.id != group.id ? e.selected : !group.selected;\r\n                return e;\r\n            })\r\n        );\r\n    };\r\n\r\n    getGroupRows = (data) => {\r\n        return data.map((e) => {\r\n            return (\r\n                <TableRow>\r\n                    <TableCell>{e.name}</TableCell>\r\n                    <TableCell>\r\n                        <Switch\r\n                            checked={e.selected}\r\n                            color=\"primary\"\r\n                            onChange={this.toSendChanged(e)}\r\n                        />\r\n                    </TableCell>\r\n                    <TableCell align=\"right\">\r\n                        <Button\r\n                            onClick={() => {\r\n                                console.log(\"sending\");\r\n                                VKMethods.postOnMyGroupWall(\r\n                                    e.id,\r\n                                    \"Тестовый пост\"\r\n                                );\r\n                            }}\r\n                        >\r\n                            Тестовый пост\r\n                        </Button>\r\n                    </TableCell>\r\n                </TableRow>\r\n            );\r\n        });\r\n    };\r\n\r\n    render = () => {\r\n        if (this.state.renderedPlatform != this.props.platform) {\r\n            this.props.tab.reload();\r\n        }\r\n        if (!this.state.loaded) {\r\n            return <CircularProgress style={{ padding: 20 }} />;\r\n        }\r\n        return (\r\n            <TableContainer component={Paper}>\r\n                <Table>\r\n                    <TableHead>\r\n                        <TableRow>\r\n                            <TableCell>Группа</TableCell>\r\n                            <TableCell>Отправка</TableCell>\r\n                            <TableCell align=\"right\">\r\n                                <Button onClick={this.props.tab.reload}>\r\n                                    <RefreshIcon />\r\n                                </Button>\r\n                            </TableCell>\r\n                        </TableRow>\r\n                    </TableHead>\r\n                    <TableBody>\r\n                        {this.getGroupRows(this.state.groups)}\r\n                    </TableBody>\r\n                </Table>\r\n            </TableContainer>\r\n        );\r\n    };\r\n}\r\n\r\nexport { MessagesTab, PostsTab };\r\n"]},"metadata":{},"sourceType":"module"}