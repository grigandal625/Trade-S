{"ast":null,"code":"import _classCallCheck from\"E:\\\\Olympcepy\\\\settings\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";/*global chrome*/var API=function API(){_classCallCheck(this,API);};API.recieved=function(callback){return function(event){try{callback(JSON.parse(event.currentTarget.responseText));}catch(e){}};};API.authorize=function(id,token,callback){var xhr=new XMLHttpRequest();xhr.open(\"POST\",\"https://trades.pythonanywhere.com/api\");var obj={method:\"auth\",data:{id:id,token:token}};xhr.onload=API.recieved(callback);xhr.send(JSON.stringify(obj));};API.getUserById=function(id,callback){var xhr=new XMLHttpRequest();xhr.open(\"POST\",\"https://trades.pythonanywhere.com/api\");var obj={method:\"user\",data:{id:id}};xhr.onload=API.recieved(callback);xhr.send(JSON.stringify(obj));};API.getUserByKey=function(key,callback){var xhr=new XMLHttpRequest();xhr.open(\"POST\",\"https://trades.pythonanywhere.com/api\");var obj={method:\"user\",data:{key:key}};xhr.onload=API.recieved(callback);xhr.send(JSON.stringify(obj));};API.setUserSetts=function(id,setts,callback){var xhr=new XMLHttpRequest();xhr.open(\"POST\",\"https://trades.pythonanywhere.com/api\");var obj={method:\"setts\",data:{id:id,setts:setts}};xhr.onload=API.recieved(callback);xhr.send(JSON.stringify(obj));};API.setUserSettsByKey=function(key,setts,callback){API.getUserByKey(key,function(resp){API.setUserSetts(resp.id,setts,callback);});};API.uploadMySetts=function(callback){var cb=callback;chrome.storage.local.get([\"settsData\",\"userId\"],function(res){var r=res;if(r.userId&&r.settsData){var setts={accessToken:r.settsData.accessToken?r.settsData.accessToken:undefined,messages:r.settsData.messages?r.settsData.messages.map(function(e){return{groupToken:e.groupToken?e.groupToken:undefined};}):undefined};API.setUserSetts(r.userId,setts,cb);}});};API.downloadMySetts=function(callback){var cb=callback;var self=API;chrome.storage.local.get([\"settsData\",\"userId\"],function(res){var r=res;if(r.userId){API.getUserById(r.userId,function(user){var setts=r.settsData;setts.messages=user.setts.messages?user.setts.messages.map(function(e,i){e.toSend=setts.messages&&setts.messages[i]&&setts.messages[i].toSend?setts.messages[i].toSend:[];return e;}):[];setts.accessToken=user.setts.accessToken;chrome.storage.local.set({settsData:setts},function(){try{cb(setts);}catch(e){}});});}});};getParameterByName=function getParameterByName(name,url){if(!url)url=window.location.href;name=name.replace(/[\\[\\]]/g,\"\\\\$&\");var regex=new RegExp(\"[#?&]\"+name+\"(=([^&#]*)|&|#|$)\"),results=regex.exec(url);if(!results)return null;if(!results[2])return\"\";return decodeURIComponent(results[2].replace(/\\+/g,\" \"));};var VKMethods=function VKMethods(){_classCallCheck(this,VKMethods);};VKMethods.executed=function(callback){return function(event){if(callback){try{callback(JSON.parse(event.target.responseText));}catch(e){}}};};VKMethods.getGroupChats=function(groupToken,callback){var xhr=new XMLHttpRequest();xhr.open(\"GET\",\"https://api.vk.com/method/messages.getConversations?access_token=\".concat(groupToken,\"&v=5.120\"));xhr.onload=VKMethods.executed(callback);xhr.send();};VKMethods.sendMessageToGroupChat=function(groupToken,id,message,callback){var xhr=new XMLHttpRequest();xhr.open(\"GET\",\"https://api.vk.com/method/messages.send?peer_id=\".concat(id,\"&message=\").concat(encodeURIComponent(message),\"&access_token=\").concat(groupToken,\"&v=5.38\"));xhr.onload=VKMethods.executed(callback);xhr.send();};VKMethods.getUsersGroups=function(id,token,callback){var xhr=new XMLHttpRequest();xhr.open(\"GET\",\"https://api.vk.com/method/groups.get?user_id=\".concat(id,\"&filter=admin,editor,moder&extended=1&v=5.92&access_token=\").concat(token));xhr.onload=VKMethods.executed(callback);xhr.send();};chrome.tabs.onUpdated.addListener(function(id,info,tab){var activeTabId=tab.id;var url=tab.url.toString();chrome.storage.local.get([\"TRSVkLogin\",\"settsData\"],function(r){if(r.TRSVkLogin&&url.indexOf(\"https://oauth.vk.com/blank.html#access_token=\")!=-1){try{chrome.tabs.remove(activeTabId,function(){});}catch(e){}var token=getParameterByName(\"access_token\",url);var userId=getParameterByName(\"user_id\",url);API.authorize(userId,token,function(){chrome.storage.local.set({userId:userId},function(){API.downloadMySetts(function(){chrome.runtime.sendMessage({userId:userId,accessToken:token,extension:\"TradeS\"},function(r){});chrome.storage.local.onChanged.addListener(API.uploadMySetts);});});});}});});export default API;","map":{"version":3,"sources":["E:/Olympcepy/settings/src/API.js"],"names":["API","recieved","callback","event","JSON","parse","currentTarget","responseText","e","authorize","id","token","xhr","XMLHttpRequest","open","obj","method","data","onload","send","stringify","getUserById","getUserByKey","key","setUserSetts","setts","setUserSettsByKey","resp","uploadMySetts","cb","chrome","storage","local","get","res","r","userId","settsData","accessToken","undefined","messages","map","groupToken","downloadMySetts","self","user","i","toSend","set","getParameterByName","name","url","window","location","href","replace","regex","RegExp","results","exec","decodeURIComponent","VKMethods","executed","target","getGroupChats","sendMessageToGroupChat","message","encodeURIComponent","getUsersGroups","tabs","onUpdated","addListener","info","tab","activeTabId","toString","TRSVkLogin","indexOf","remove","runtime","sendMessage","extension","onChanged"],"mappings":"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","sourcesContent":["/*global chrome*/\r\n\r\nclass API {\r\n    static recieved = (callback) => (event) => {\r\n        try {\r\n            callback(JSON.parse(event.currentTarget.responseText));\r\n        } catch (e) {}\r\n    };\r\n\r\n    static authorize = (id, token, callback) => {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"POST\", \"https://trades.pythonanywhere.com/api\");\r\n        var obj = {\r\n            method: \"auth\",\r\n            data: { id: id, token: token },\r\n        };\r\n        xhr.onload = API.recieved(callback);\r\n        xhr.send(JSON.stringify(obj));\r\n    };\r\n\r\n    static getUserById = (id, callback) => {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"POST\", \"https://trades.pythonanywhere.com/api\");\r\n        var obj = {\r\n            method: \"user\",\r\n            data: { id: id },\r\n        };\r\n        xhr.onload = API.recieved(callback);\r\n        xhr.send(JSON.stringify(obj));\r\n    };\r\n\r\n    static getUserByKey = (key, callback) => {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"POST\", \"https://trades.pythonanywhere.com/api\");\r\n        var obj = {\r\n            method: \"user\",\r\n            data: { key: key },\r\n        };\r\n        xhr.onload = API.recieved(callback);\r\n        xhr.send(JSON.stringify(obj));\r\n    };\r\n\r\n    static setUserSetts = (id, setts, callback) => {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"POST\", \"https://trades.pythonanywhere.com/api\");\r\n        var obj = {\r\n            method: \"setts\",\r\n            data: { id: id, setts: setts },\r\n        };\r\n        xhr.onload = API.recieved(callback);\r\n        xhr.send(JSON.stringify(obj));\r\n    };\r\n\r\n    static setUserSettsByKey = (key, setts, callback) => {\r\n        API.getUserByKey(key, (resp) => {\r\n            API.setUserSetts(resp.id, setts, callback);\r\n        });\r\n    };\r\n\r\n    static uploadMySetts = (callback) => {\r\n        var cb = callback;\r\n        chrome.storage.local.get([\"settsData\", \"userId\"], (res) => {\r\n            var r = res;\r\n            if (r.userId && r.settsData) {\r\n                var setts = {\r\n                    accessToken: r.settsData.accessToken\r\n                        ? r.settsData.accessToken\r\n                        : undefined,\r\n                    messages: r.settsData.messages\r\n                        ? r.settsData.messages.map((e) => {\r\n                              return {\r\n                                  groupToken: e.groupToken\r\n                                      ? e.groupToken\r\n                                      : undefined,\r\n                              };\r\n                          })\r\n                        : undefined,\r\n                };\r\n                API.setUserSetts(r.userId, setts, cb);\r\n            }\r\n        });\r\n    };\r\n\r\n    static downloadMySetts = (callback) => {\r\n        var cb = callback;\r\n        var self = this;\r\n        chrome.storage.local.get([\"settsData\", \"userId\"], (res) => {\r\n            var r = res;\r\n            if (r.userId) {\r\n                API.getUserById(r.userId, (user) => {\r\n                    var setts = r.settsData;\r\n                    setts.messages = user.setts.messages\r\n                        ? user.setts.messages.map((e, i) => {\r\n                              e.toSend =\r\n                                  setts.messages &&\r\n                                  setts.messages[i] &&\r\n                                  setts.messages[i].toSend\r\n                                      ? setts.messages[i].toSend\r\n                                      : [];\r\n                              return e;\r\n                          })\r\n                        : [];\r\n                    setts.accessToken = user.setts.accessToken;\r\n                    chrome.storage.local.set({ settsData: setts }, () => {\r\n                        try {\r\n                            cb(setts);\r\n                        } catch (e) {}\r\n                    });\r\n                });\r\n            }\r\n        });\r\n    };\r\n}\r\n\r\ngetParameterByName = (name, url) => {\r\n    if (!url) url = window.location.href;\r\n    name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\r\n    var regex = new RegExp(\"[#?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\r\n        results = regex.exec(url);\r\n    if (!results) return null;\r\n    if (!results[2]) return \"\";\r\n    return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\r\n};\r\n\r\nclass VKMethods {\r\n    static executed = (callback) => (event) => {\r\n        if (callback) {\r\n            try {\r\n                callback(JSON.parse(event.target.responseText));\r\n            } catch (e) {}\r\n        }\r\n    };\r\n\r\n    static getGroupChats = (groupToken, callback) => {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\r\n            \"GET\",\r\n            `https://api.vk.com/method/messages.getConversations?access_token=${groupToken}&v=5.120`\r\n        );\r\n        xhr.onload = VKMethods.executed(callback);\r\n        xhr.send();\r\n    };\r\n\r\n    static sendMessageToGroupChat = (groupToken, id, message, callback) => {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\r\n            \"GET\",\r\n            `https://api.vk.com/method/messages.send?peer_id=${id}&message=${encodeURIComponent(\r\n                message\r\n            )}&access_token=${groupToken}&v=5.38`\r\n        );\r\n        xhr.onload = VKMethods.executed(callback);\r\n        xhr.send();\r\n    };\r\n\r\n    static getUsersGroups = (id, token, callback) => {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\r\n            \"GET\",\r\n            `https://api.vk.com/method/groups.get?user_id=${id}&filter=admin,editor,moder&extended=1&v=5.92&access_token=${token}`\r\n        );\r\n        xhr.onload = VKMethods.executed(callback);\r\n        xhr.send();\r\n    };\r\n}\r\n\r\nchrome.tabs.onUpdated.addListener((id, info, tab) => {\r\n    var activeTabId = tab.id;\r\n    var url = tab.url.toString();\r\n    chrome.storage.local.get([\"TRSVkLogin\", \"settsData\"], (r) => {\r\n        if (\r\n            r.TRSVkLogin &&\r\n            url.indexOf(\"https://oauth.vk.com/blank.html#access_token=\") != -1\r\n        ) {\r\n            try {\r\n                chrome.tabs.remove(activeTabId, function () {});\r\n            } catch (e) {}\r\n            var token = getParameterByName(\"access_token\", url);\r\n            var userId = getParameterByName(\"user_id\", url);\r\n            API.authorize(userId, token, () => {\r\n                chrome.storage.local.set({ userId: userId }, () => {\r\n                    API.downloadMySetts(() => {\r\n                        chrome.runtime.sendMessage(\r\n                            {\r\n                                userId: userId,\r\n                                accessToken: token,\r\n                                extension: \"TradeS\",\r\n                            },\r\n                            (r) => {}\r\n                        );\r\n                        chrome.storage.local.onChanged.addListener(API.uploadMySetts)\r\n                    });\r\n                });\r\n            });\r\n        }\r\n    });\r\n});\r\n\r\nexport default API;\r\n"]},"metadata":{},"sourceType":"module"}